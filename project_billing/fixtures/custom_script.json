[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Task",
  "modified": "2021-04-18 08:24:38.141545",
  "name": "Task-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Task', {\n\trefresh: function(frm) {\n\t\tif (frm.doc.percent_billed > 0) {\n\t\t    frm.set_df_property('billable_amount', 'read_only', 1);\n\t\t    frm.set_df_property('is_milestone', 'read_only', 1);\n\t\t}\n\t\tif (frm.doc.item) {\n\t\t    frm.set_df_property('task_group', 'read_only', 1);\n\t\t}\n\t}\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Invoice",
  "modified": "2021-04-19 17:23:28.793286",
  "name": "Sales Invoice-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Invoice', {\n    project: function(frm) {\n\t\tif(frm.doc.project) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"project_billing.project_billing.utils.get_billing_details\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t'doc': frm.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\tlet tasks = r.message[0];\n\t\t\t\t\t\tlet project_retention_amount = r.message[1];\n                        if (tasks.length > 0) {\n                            frm.set_value('items', []);\n                            tasks.forEach(function(task) {\n                                let row = frm.add_child('items', {\n                                    item_code:task.item_code,\n                                    item_name:task.item_name,\n                                    rate: task.rate,\n                                    full_rate: task.full_rate,\n                                    uom:task.uom,\n                                    qty:task.qty,\n                                    description:task.description,\n                                    conversion_factor: task.conversion_factor,\n                                    income_account: task.income_account,\n                                    amount: task.amount,\n                                    full_amount: task.full_amount,\n                                    retention_amount: task.retention_amount,\n                                    reference_task: task.reference_task,\n                                    billable_amount: task.billable_amount,\n                                    task_progress: task.task_progress,\n                                    percent_billed: task.percent_billed\n                                });\n                                frm.refresh_field('items');\n                                frm.set_value('project_retention_amount', project_retention_amount);\n                            });\n                        } else {\n                            frappe.show_alert({\n                                message:__('No Tasks for the selected Project indicate billable progress, please try after updating Task progress / status'),\n                                indicator:'orange'\n                                \n                            });\n                            // frm.set_value('project', '');\n                        }\n\t\t\t\t    }\n\t\t\t    }\n\t\t    });\n        }\n    }\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Project",
  "modified": "2021-04-18 19:40:13.307674",
  "name": "Project-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project', {\n\trefresh: function(frm) {\n\t\tif (frm.doc.total_billed_amount > 0) {\n\t\t    frm.set_df_property('retention_percentage', 'read_only', 1);\n\t\t    frm.set_df_property('percent_complete_method', 'read_only', 1);\n\t\t}\n\t}\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Project Template",
  "modified": "2021-04-19 17:23:09.611072",
  "name": "Project Template-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project Template', {\n\tvalidate: function(frm) {\n\t    const uniqueValues = new Set(frm.doc.tasks.map(v => v.subject));\n\n        if (uniqueValues.size < frm.doc.tasks.length) {\n          frappe.throw(__('Template contains multiple Tasks with same Subject'));\n        }\n\t}\n});"
 }
]